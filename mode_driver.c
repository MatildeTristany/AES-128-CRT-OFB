/* this file gets replaced with our own driver when we grade your submission.
 * So do what you want here but realize it won't persist when we grade it.
 */

#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include "aes128e.h"
#include "mode.h"

void test_CTR_test_vector(void);
void test_CTR_counter_update(void);
void test_CTR_char_key(void);
void test_OFB_test_vector(void);
void test_OFB_long_text(void);
void test_OFB_char_key(void);

int main(void){
  test_CTR_test_vector();
  test_CTR_counter_update();
  test_CTR_char_key();
  test_OFB_test_vector();
  test_OFB_long_text();
  test_OFB_char_key();	
  return 0;
} 


//This is the test vector given in the specification document.
//All the intermediate steps are given in the specification document
void test_CTR_test_vector(){
  unsigned char ctr[16] = {
    0xf0,0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,0xf9,0xfa,0xfb,0xfc,0xfd,0xfe,0xff};
  unsigned char key[16] = {
    0x2b,0x7e,0x15,0x16,0x28,0xae,0xd2,0xa6,0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c};
  //plaintext is 4 blocks of 16 bytes
  unsigned char plain[64] = {
    0x6b,0xc1,0xbe,0xe2,0x2e,0x40,0x9f,0x96,0xe9,0x3d,0x7e,0x11,0x73,0x93,0x17,0x2a,
    0xae,0x2d,0x8a,0x57,0x1e,0x03,0xac,0x9c,0x9e,0xb7,0x6f,0xac,0x45,0xaf,0x8e,0x51,
    0x30,0xc8,0x1c,0x46,0xa3,0x5c,0xe4,0x11,0xe5,0xfb,0xc1,0x19,0x1a,0x0a,0x52,0xef,
    0xf6,0x9f,0x24,0x45,0xdf,0x4f,0x9b,0x17,0xad,0x2b,0x41,0x7b,0xe6,0x6c,0x37,0x10};
  //The ciphertext should correspond to this solution
  unsigned char solution[64] = {
    0x87,0x4d,0x61,0x91,0xb6,0x20,0xe3,0x26,0x1b,0xef,0x68,0x64,0x99,0x0d,0xb6,0xce,
    0x98,0x06,0xf6,0x6b,0x79,0x70,0xfd,0xff,0x86,0x17,0x18,0x7b,0xb9,0xff,0xfd,0xff,
    0x5a,0xe4,0xdf,0x3e,0xdb,0xd5,0xd3,0x5e,0x5b,0x4f,0x09,0x02,0x0d,0xb0,0x3e,0xab,
    0x1e,0x03,0x1d,0xda,0x2f,0xbe,0x03,0xd1,0x79,0x21,0x70,0xa0,0xf3,0x00,0x9c,0xee};

  unsigned char cipher[64];
  CTRaes128e(cipher,plain,64,ctr,key);

  printf("CTR1 %s\n", !memcmp(cipher, solution, 64 ) ? "PASS" : "FAIL");
}

//With this test vector, we want to check that the counter has been implemented correctly and that the last block has been correctly handled. 
void test_CTR_counter_update(){
  //The initial counter agreed between the 2 parties
  unsigned char ctr[16] = {
    0xf0,0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfa};
  unsigned char key[16] = {
    0x2b,0x7e,0x15,0x16,0x28,0xae,0xd2,0xa6,0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c};
  unsigned char plain[226] = "Lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua Ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat";
  unsigned char solution[226] = {
    0xea,0x56,0xbf,0xaa,0x87,0x12,0x9a,0xc4,0xf6,0x11,0xe3,0x9a,0xf4,0x69,0xc3,0x3a,
    0xfc,0xad,0x45,0x1e,0xc8,0x71,0x13,0x6d,0xd5,0x9b,0x6a,0xf6,0x5a,0x69,0xaa,0x23,
    0x08,0x40,0x80,0x51,0x49,0x7f,0x1b,0xa9,0x8c,0x64,0x94,0x3a,0x18,0xd3,0xdb,0xb7,
    0xe4,0xa3,0x6b,0xf5,0x4c,0xd4,0x80,0x40,0xb8,0xfb,0xee,0x07,0x1e,0x28,0x69,0x10,
    0x48,0x34,0x04,0x18,0x20,0x44,0x0c,0x27,0x12,0xca,0x87,0xb2,0x35,0x5b,0x65,0x10,
    0x18,0x4a,0xf8,0x77,0x7f,0x60,0xb2,0xf8,0xd9,0x09,0x92,0xfb,0x61,0x83,0x49,0xeb,
    0x69,0x0f,0xde,0xc2,0x7a,0xbd,0x08,0x46,0x76,0x8c,0x98,0x15,0xf6,0x92,0x2c,0x6c,
    0xce,0x8f,0xfd,0x9e,0x83,0xa8,0x18,0x52,0xc0,0xf0,0xb5,0xf6,0x2c,0xef,0xd9,0xa3,
    0x03,0x41,0xc4,0x2c,0xf9,0x62,0x2f,0x30,0x9b,0x43,0xb2,0xb3,0xe1,0x00,0x27,0x8f,
    0xf9,0x66,0xdc,0x1d,0xe7,0x3a,0xde,0xfb,0x48,0x27,0xd6,0xff,0xaf,0x1a,0xfb,0x20,
    0x79,0xf3,0xa8,0xe7,0x7c,0x96,0x38,0xc0,0x03,0x95,0x3e,0x8c,0x6c,0x39,0x1f,0x42,
    0x21,0x72,0xc4,0x2a,0x95,0x0a,0x44,0x9f,0x79,0xf8,0xcf,0x98,0x9f,0xa4,0x3d,0xfc,
    0x1f,0xf2,0x78,0xf8,0xec,0xa1,0x14,0xa0,0x3b,0xb0,0xf3,0x35,0x84,0x55,0x08,0xcf,
    0x5f,0xc8,0x7a,0x8b,0x5b,0x87,0x2c,0x08,0x46,0x50,0xe7,0x95,0x68,0x61,0x1f,0x05,
    0x27,0x01
  };
  unsigned char cipher[226];
  CTRaes128e(cipher,plain,226,ctr,key);
  printf("CTR2 %s\n", !memcmp(cipher, solution, 226 ) ? "PASS" : "FAIL");	
}

//Another test for the CRT mode of encryption
void test_CTR_char_key(){
  unsigned char ctr[16] = {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  unsigned char key[16] = "hellohellohello1";
  unsigned char plain[237] = "Modern cryptography is heavily based on mathematical theory and computer science practice; cryptographic algorithms are designed around computational hardness assumptions, making such algorithms hard to break in practice by any adversary";
  unsigned char cipher[237];
  unsigned char solution[237] = {
    0x26,0x85,0xcb,0x17,0x9f,0x3f,0x35,0x48,0xf0,0xd1,0x4e,0x8e,0xcc,0x26,0x56,0x35,
    0xc1,0x8e,0x23,0x0e,0xd6,0xac,0xbe,0xff,0x5f,0xc8,0xbe,0x53,0x29,0xbd,0x17,0x03,
    0x20,0x52,0x6a,0x64,0x1b,0xbc,0x44,0x0e,0xc4,0xb3,0x80,0x9c,0x2a,0xf7,0xec,0xdb,
    0x38,0xe0,0xe2,0xb4,0x60,0xa0,0x1a,0xa0,0x41,0x89,0xc6,0xd8,0x25,0x02,0x04,0x78,
    0x60,0x91,0x0a,0xcd,0x62,0xb8,0xc3,0x6f,0x67,0xdc,0x06,0xb9,0x38,0xf1,0x0a,0x87,
    0x0b,0xc6,0x5e,0x14,0x78,0x1a,0x60,0x77,0xa8,0xff,0x50,0x39,0x17,0xad,0x4c,0x7b,
    0x63,0x84,0x3c,0xe8,0x25,0x51,0x24,0xb1,0x02,0x2a,0xcf,0x5d,0x36,0x01,0xea,0x9d,
    0x06,0xc5,0xf0,0x6f,0x4a,0x02,0xda,0x57,0x6f,0xdc,0x89,0x19,0xed,0x58,0xe2,0x0e,
    0xc9,0x80,0x57,0x0f,0x93,0x9f,0x09,0x79,0xf4,0x46,0x2d,0xe0,0x2f,0x17,0x3e,0x80,
    0x9c,0x58,0xaf,0x36,0xa4,0xd9,0x04,0x29,0x5f,0x2e,0x39,0x08,0x78,0xb7,0x5d,0x60,
    0xe4,0xff,0xb4,0x36,0xcc,0x56,0xd6,0x44,0xc6,0x8c,0x06,0xad,0xec,0x19,0x27,0x72,
    0x3a,0x61,0x04,0x94,0x84,0x38,0x84,0x83,0xd1,0x16,0x1b,0xd1,0x44,0x87,0x97,0x8f,
    0x83,0x43,0xa2,0xc7,0x88,0x09,0x66,0x82,0x4d,0x27,0x5f,0x5a,0x46,0xba,0xb5,0xbb,
    0x90,0x0d,0x78,0x42,0x58,0x3e,0xb1,0xd6,0x44,0x7a,0x10,0xcf,0x0c,0x4e,0x76,0x3c,
    0xd7,0x6b,0x82,0x59,0x5f,0x0c,0x6a,0x0d,0x94,0xbc,0xe0,0x9f,0xec};
  CTRaes128e(cipher,plain,237,ctr,key);
  printf("CTR3 %s\n", !memcmp(cipher, solution, 237 ) ? "PASS" : "FAIL");	
}

//First test for the OFB encryption mode.
//This is the test vector given in the specification document
void test_OFB_test_vector(){
  unsigned char iv[16] = {
    0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f};
  unsigned char key[16] = {
    0x2b,0x7e,0x15,0x16,0x28,0xae,0xd2,0xa6,0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c};
  //The plaintext has a length of 4 blocks of 16 bytes. 
  unsigned char plain[64] = {
    0x6b,0xc1,0xbe,0xe2,0x2e,0x40,0x9f,0x96,0xe9,0x3d,0x7e,0x11,0x73,0x93,0x17,0x2a,
    0xae,0x2d,0x8a,0x57,0x1e,0x03,0xac,0x9c,0x9e,0xb7,0x6f,0xac,0x45,0xaf,0x8e,0x51,
    0x30,0xc8,0x1c,0x46,0xa3,0x5c,0xe4,0x11,0xe5,0xfb,0xc1,0x19,0x1a,0x0a,0x52,0xef,
    0xf6,0x9f,0x24,0x45,0xdf,0x4f,0x9b,0x17,0xad,0x2b,0x41,0x7b,0xe6,0x6c,0x37,0x10};
  unsigned char solution[64] = {
    0x3b,0x3f,0xd9,0x2e,0xb7,0x2d,0xad,0x20,0x33,0x34,0x49,0xf8,0xe8,0x3c,0xfb,0x4a,
    0x77,0x89,0x50,0x8d,0x16,0x91,0x8f,0x03,0xf5,0x3c,0x52,0xda,0xc5,0x4e,0xd8,0x25,
    0x97,0x40,0x05,0x1e,0x9c,0x5f,0xec,0xf6,0x43,0x44,0xf7,0xa8,0x22,0x60,0xed,0xcc,
    0x30,0x4c,0x65,0x28,0xf6,0x59,0xc7,0x78,0x66,0xa5,0x10,0xd9,0xc1,0xd6,0xae,0x5e};

  unsigned char cipher[64];
  OFBaes128e(cipher,plain,64,iv,key);
	
  printf("OFB1 %s\n", !memcmp(cipher, solution, 64 ) ? "PASS" : "FAIL");
}


//test the OFB mode with a longer text and a last block which is not full. 
void test_OFB_long_text(){
  unsigned char iv[16] = {
    0xf0,0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,0xf9,0xfa,0xfb,0xfc,0xfd,0xfe,0xff};
  unsigned char key[16] = {
    0x2b,0x7e,0x15,0x16,0x28,0xae,0xd2,0xa6,0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c};
  unsigned char plain[226] = "Lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua Ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat";
  unsigned char solution[226] = {
    0xa0,0xe3,0xad,0x16,0xf5,0x40,0x15,0xc0,0x81,0xa7,0x7b,0x55,0x8e,0xf1,0xcd,0x8b,
    0xeb,0x58,0x63,0x72,0xdb,0x87,0xff,0x9f,0x50,0x3a,0x3d,0x21,0x54,0x51,0x5a,0x9e,
    0xdf,0x9d,0xdf,0xe8,0x1d,0x67,0x77,0xb8,0xfa,0x2a,0xa2,0x47,0xfe,0x4c,0xee,0x7a,
    0x0e,0xca,0x0c,0x45,0xb3,0x22,0x9b,0x69,0x11,0xe6,0x98,0x54,0x96,0x01,0x87,0x17,
    0xb0,0x4e,0x15,0x8c,0xba,0x0d,0x99,0x8d,0xfb,0xa5,0x66,0xb2,0x48,0xe4,0x7d,0x61,
    0x81,0x05,0x7c,0xf4,0x13,0x0c,0x9e,0x80,0xc4,0x33,0xdf,0x74,0xae,0x49,0x5f,0xd0,
    0x87,0x8d,0xad,0xd1,0x97,0x31,0xff,0x31,0xae,0xb5,0x8a,0xfc,0x9e,0x9c,0x47,0x4e,
    0xc0,0x2b,0xed,0x4d,0x05,0x10,0x6f,0x9f,0xc6,0x95,0x9e,0xf9,0x43,0x01,0x15,0x33,
    0x0d,0xab,0x77,0x0b,0x31,0x86,0x58,0xbb,0x45,0xe5,0x3a,0xeb,0xda,0xc2,0x08,0x41,
    0x79,0x38,0xae,0x5e,0xa3,0x3c,0x99,0x49,0x09,0x6c,0xfa,0x97,0x9a,0x79,0x05,0x0f,
    0x14,0x7a,0x77,0x79,0x75,0xf0,0xe7,0x9e,0x3b,0x40,0xbf,0x44,0x38,0xb6,0x99,0x86,
    0x5a,0xd0,0x9c,0x50,0x61,0xb3,0xa4,0xc5,0x44,0x3b,0xde,0xc3,0xec,0x54,0xfc,0x31,
    0x4b,0x31,0x85,0x26,0xbc,0x60,0x5e,0x0b,0xa2,0x60,0x86,0x72,0xf9,0x52,0xf0,0xd0,
    0xdb,0x05,0x9f,0x7c,0x31,0x30,0x26,0x18,0x5b,0x0c,0x0a,0x90,0x92,0x66,0xfa,0x25,
    0x1e,0x49
  };
  unsigned char cipher[226];
  OFBaes128e(cipher,plain,226,iv,key);
  printf("OFB2 %s\n", !memcmp(cipher, solution, 226 ) ? "PASS" : "FAIL");	
}

//other test for the OFB encryption mode
void test_OFB_char_key(){
  unsigned char iv[16] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  unsigned char key[16] = "hellohellohello1";
  unsigned char plain[237] = "Modern cryptography is heavily based on mathematical theory and computer science practice; cryptographic algorithms are designed around computational hardness assumptions, making such algorithms hard to break in practice by any adversary";
  unsigned char solution[237] = {
    0x26,0x85,0xcb,0x17,0x9f,0x3f,0x35,0x48,0xf0,0xd1,0x4e,0x8e,0xcc,0x26,0x56,0x35,
    0xf8,0x3b,0x49,0xc3,0x5c,0xfa,0xe9,0x1a,0x26,0x0e,0xa0,0xfe,0x9c,0xef,0x38,0xd8,
    0x1c,0x53,0x89,0xaf,0xba,0x0b,0x74,0x71,0x39,0x64,0x5f,0x6e,0xab,0x14,0xd0,0xb1,
    0xd4,0xbc,0xf3,0xc5,0x0b,0xbb,0xf2,0x36,0x76,0x99,0x4a,0x12,0x11,0x6f,0x16,0x87,
    0xf1,0xdb,0x23,0x96,0x21,0xa1,0x13,0x03,0x84,0x28,0xa6,0x85,0x28,0x6d,0x85,0x42,
    0x4d,0x63,0x56,0x2b,0xb4,0xf0,0xf8,0xa6,0x28,0x2a,0x4c,0x02,0x63,0x8d,0xbc,0xba,
    0x74,0x6f,0xba,0x39,0xfd,0x17,0xb8,0xcf,0x05,0x16,0x7d,0x13,0x7a,0x1c,0xb4,0x3c,
    0x54,0x7b,0xac,0x95,0x0f,0x9c,0xee,0x38,0x93,0xe8,0x79,0xa6,0x34,0xd0,0x66,0x94,
    0x38,0x99,0xe8,0x7f,0xbd,0x66,0xf1,0x6c,0xc6,0xf8,0xed,0x9c,0xb6,0x97,0xfd,0xbf,
    0x96,0xa7,0xc8,0x47,0x82,0x55,0xe5,0x6d,0x21,0x4c,0x1b,0x57,0x11,0xac,0xf3,0xdb,
    0x22,0x99,0xfc,0xdd,0xc1,0xaf,0x8f,0xb2,0x28,0x45,0x0d,0xcb,0xbc,0x4b,0x51,0xc5,
    0x54,0x26,0xa3,0xb5,0xf1,0x98,0x22,0xba,0x72,0xc2,0x16,0x29,0x64,0xe8,0x42,0xaf,
    0xc4,0x2e,0x31,0xcb,0xa0,0xfa,0x2b,0x28,0x9e,0xc0,0xe5,0x36,0x89,0xb4,0x32,0x83,
    0xd5,0x26,0x6c,0x62,0xde,0x8b,0x40,0x2a,0x2d,0x2a,0x5a,0x8a,0x60,0x4c,0x5f,0x02,
    0xd7,0x7e,0xa8,0x3b,0xf2,0x69,0xfd,0x7e,0x4d,0x18,0x3a,0x41,0x83
  };
  unsigned char cipher[237];
  OFBaes128e(cipher,plain,237,iv,key);
  printf("OFB3 %s\n", !memcmp(cipher, solution, 237 ) ? "PASS" : "FAIL");	
}

